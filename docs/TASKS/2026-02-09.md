# Tasks for 2026-02-09 (Mon)

Context: DriveTuning Build Passport (Germany/EU). Focus: legality/evidence + privacy-by-default. Monetization: keep implemented but disabled for ~1 year.

## Status Snapshot (repo state as of 2026-02-09)
- ✅ Build Passport route `/build/[slug]` with privacy enforcement.
- ✅ Share links + GDPR-friendly view logging + consent toggle (`/api/consent/analytics`).
- ✅ TÜV evidence models exist (`ApprovalDocument` etc) and are attachable to modifications.
- ✅ DE places + car meta dictionaries exist.
- ✅ New: DE tuning legality reference scaffold:
  - `data/reference/tuning-legality-de.json`
  - `GET /api/dictionary/tuning-legality`
  - `npm run ref:tuning-legality:validate`

## Today’s Priorities (recommended order)

### 1) Legality Reference (DE) Baseline
- Expand `data/reference/tuning-legality-de.json` with high-value items that have primary sources:
  - retrofit lighting ABG/ECE (manufacturer certificates)
  - wheels (ABE/Teilegutachten) where documents are directly downloadable
  - suspension (ABE/Teilegutachten) where documents are directly downloadable
- Add a simple rule: never fill `approvalNumber` unless it is explicitly visible in the source.
- Keep licensing/ToS safe: do not scrape TÜV/DEKRA databases.

Acceptance:
- Dictionary returns useful suggestions for at least 10-30 real entries with source URLs.

### 2) Integrate Legality Into Modification UX (non-blocking)
- In modification create/edit UI:
  - show legality hints (approval type definitions + checklist)
  - add "Attach document" CTA for `ApprovalDocument`
- Add a badge component (status: `UNKNOWN/FULLY_LEGAL/REG_REQUIRED/INSPECTION_REQUIRED/ILLEGAL`) backed by evidence presence, not guesses.

Acceptance:
- Users can store ABE/ABG/Teilegutachten PDFs and see a consistent "what next" message.

### 3) GDPR Retention Enforcement (automation)
- Implement a retention job for `ShareLinkView` anonymization/deletion based on `SHARE_LINK_VIEW_RETENTION_DAYS`.
- Prefer a daily scheduled endpoint (Vercel Cron) or a safe on-demand admin route.

Acceptance:
- Old view logs are anonymized/removed automatically without manual DB work.

### 4) Auth Hardening (DE/EU risk reduction)
- Move away from passwords stored in DB:
  - Email magic links (NextAuth EmailProvider) or an IdP (Clerk/Auth0)
- If passwords remain: enforce policy + rate limit + reset flows (already partly present).

Acceptance:
- No plaintext password handling and reduced breach blast radius.

### 6) Mobile First For "Share Link At Car Meets"
- Improve `/build/[slug]` mobile readability:
  - make evidence/doc links tap-friendly
  - ensure PDF export is readable on iOS/Android
- Add skeletons on slow loads to avoid "glass UI freezes".

Acceptance:
- Share link looks good on phone and PDF export is usable.

### 7) Offline Garage (defer, but design now)
- PWA + offline queue for garage log entries (IndexedDB + sync queue).

Acceptance:
- Clear technical plan + minimal spike (no full build yet).

### 8) Evidence Score v2 (trust model)
- Rework into weighted factors driven by evidence presence:
  - photo, receipt, approval doc, entry timestamp consistency
- Expose as badge tiers and allow filtering in marketplace later (still disabled).

Acceptance:
- Evidence score is explainable and stable (no opaque "AI number").

### 9) Reference Data Quality (brands/models)
- Tighten normalization and fuzzy search UX for adding a car (avoid duplicates).
- Add DE-specific identifiers where available (HSN/TSN) as optional reference fields.

Acceptance:
- User can add car without typing free-form make/model; fewer duplicates.

### 10) Monitoring/Health (production hygiene)
- Ensure blob, DB, and cron endpoints have health checks and are covered in `docs/MONITORING.md`.

Acceptance:
- Simple "green/red" checks for critical dependencies.

### 11) ToS-Safe Crowdsourcing Intake (optional)
- Allow users to submit successful TÜV/ABG cases without personal data:
  - part brand/model, approval type, doc number, and redacted PDF/photo evidence
  - moderation queue (owner-only)

Acceptance:
- Legal reference grows with community data while staying GDPR-safe.

### 12) Commerce (explicitly keep disabled)
- Keep existing commerce code behind flags; do not expose UI entry points during the free period.

Acceptance:
- No accidental checkout paths reachable in production.

